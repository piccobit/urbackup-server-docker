#!/bin/bash

if [ ! -d /cipher/backups ]; then
su -s /bin/bash -c 'gocryptfs -init -passfile /tmp/backups.passwd /cipher/backups' urbackup
fi

if [ ! -d /cipher/database ]; then
su -s /bin/bash -c 'gocryptfs -init -passfile /tmp/database.passwd /cipher/database' urbackup
fi

su -s /bin/bash -c 'gocryptfs -passfile /tmp/backups.passwd /cipher/backups /backups'
su -s /bin/bash -c 'gocryptfs -passfile /tmp/database.passwd /cipher/database /var/urbackup'

echo "/backups" > /var/urbackup/backupfolder

exec urbackupsrv "$@"
